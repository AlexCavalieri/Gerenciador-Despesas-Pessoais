<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciador de Despesas Pessoais</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Gerenciador de Despesas Pessoais</h1>
    <div class="row">
      <div class="col-md-6">
        <form id="formDespesa">
          <div class="form-group">
            <label for="inputNome">Nome da Despesa</label>
            <input type="text" class="form-control" id="inputNome" placeholder="Digite o nome da despesa">
          </div>
          <div class="form-group">
            <label for="inputValor">Valor</label>
            <input type="text" class="form-control" id="inputValor" placeholder="Digite o valor da despesa">
          </div>
          <div class="form-group">
            <label for="inputCategoria">Categoria</label>
            <input type="text" class="form-control" id="inputCategoria" placeholder="Digite a categoria da despesa">
          </div>
          <button type="submit" class="btn btn-primary">Adicionar Despesa</button>
        </form>
      </div>
      <div class="col-md-6">
        <h3>Lista de Despesas</h3>
        <ul id="listaDespesas" class="list-group">
          {% for despesa in despesas %}
          <li class="list-group-item">{{ despesa.nome }} - R$ {{ despesa.valor }} - {{ despesa.categoria }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    // Função para lidar com o envio do formulário e adicionar a despesa à lista
    $('#formDespesa').submit(function(event) {
      event.preventDefault(); // Evita o envio do formulário padrão
      var nome = $('#inputNome').val();
      var valor = $('#inputValor').val().replace(',','.');
      var categoria = $('#inputCategoria').val();
      // Validar se o valor é numérico
      if (!isNaN(parseFloat(valor)) && isFinite(valor)) {
        // Fazer requisição AJAX para adicionar a despesa
        $.ajax({
          type: 'POST',
          url: '/adicionar_despesa',
          contentType: 'application/json',
          data: JSON.stringify({nome: nome, valor: valor, categoria: categoria}),
          success: function(response) {
            console.log(response);
            // Adicionar a despesa à lista dinamicamente
            var despesaItem = '<li class="list-group-item">' + nome + ' - R$ ' + valor + ' - ' + categoria + '</li>';
            $('#listaDespesas').append(despesaItem);
            $('#formDespesa')[0].reset(); // Limpa o formulário após a adição da despesa
          },
          error: function(xhr, status, error) {
            console.error(xhr.responseText);
            alert('Erro ao adicionar despesa. Verifique o console para mais informações.');
          }
        });
      } else {
        alert('Por favor, insira um valor numérico válido.');
      }
    });
  </script>
</body>
</html>
